<script>

const ADMIN_CODE = "1995";

function login(){
let pass = document.getElementById("adminPass").value;

if(pass === ADMIN_CODE){
document.getElementById("loginBox").style.display="none";
document.getElementById("adminPanel").style.display="block";
loadProducts();
}else{
alert("كود خاطئ");
}
}

let products = JSON.parse(localStorage.getItem("products")) || [];
let editIndex = null;

function save(){
localStorage.setItem("products", JSON.stringify(products));
}

function addProduct(){

let reader = new FileReader();
let file = document.getElementById("pimage").files[0];

if(!file){
alert("اختر صورة");
return;
}

reader.onload = function(e){

let product = {
id: Date.now(),
name: document.getElementById("pname").value,
price: Number(document.getElementById("pprice").value),
stock: Number(document.getElementById("pstock").value),
discount: Number(document.getElementById("pdiscount").value),
image: e.target.result
};

if(editIndex !== null){
products[editIndex] = product;
editIndex = null;
}else{
products.push(product);
}

save();
loadProducts();
alert("تم الحفظ");

};

reader.readAsDataURL(file);
}

function loadProducts(){

let container = document.getElementById("adminProducts");
container.innerHTML="";

products.forEach((p,index)=>{
container.innerHTML += `
<div style="margin:10px 0; border-bottom:1px solid #333; padding:10px;">
<img src="${p.image}" width="60"><br>
${p.name} - ${p.price} DH
<br>
<button onclick="editProduct(${index})">تعديل</button>
<button onclick="deleteProduct(${index})">حذف</button>
</div>
`;
});

}

function editProduct(index){

let p = products[index];

document.getElementById("pname").value = p.name;
document.getElementById("pprice").value = p.price;
document.getElementById("pstock").value = p.stock;
document.getElementById("pdiscount").value = p.discount;

editIndex = index;

}

function deleteProduct(index){
products.splice(index,1);
save();
loadProducts();
}

</script>