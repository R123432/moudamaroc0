<script src="js/cart.js"></script>

<script>

function sendOrder(){

let name = document.getElementById("name").value.trim();
let address = document.getElementById("address").value.trim();
let phoneClient = document.getElementById("phone").value.trim();

if(!name || !address || !phoneClient){
alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª âŒ");
return;
}

let cart = JSON.parse(localStorage.getItem("cart")) || [];

if(cart.length === 0){
alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© âŒ");
return;
}

let products = JSON.parse(localStorage.getItem("products")) || [];

let total = 0;
let msg = "ğŸ›ï¸ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…ØªØ¬Ø± MODA MAROC%0A%0A";

msg += "ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: " + name + "%0A";
msg += "ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: " + address + "%0A";
msg += "ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: " + phoneClient + "%0A%0A";

cart.forEach(item => {

let product = products.find(p => p.id === item.id);

// Ù†Ù‚Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
if(product){
product.stock -= item.quantity;
}

let itemTotal = item.price * item.quantity;
total += itemTotal;

msg += "ğŸ“¦ " + item.name + "%0A";
msg += "Ø§Ù„Ø¹Ø¯Ø¯: " + item.quantity + "%0A";
msg += "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: " + itemTotal + " DH%0A%0A";

});

localStorage.setItem("products", JSON.stringify(products));

msg += "ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: " + total + " DH";

window.open("https://wa.me/212712120673?text=" + msg, "_blank");

// Ù†ÙØ±Øº Ø§Ù„Ø³Ù„Ø©
localStorage.removeItem("cart");

alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† âœ…");

// Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
window.location.href = "index.html";
}

</script>